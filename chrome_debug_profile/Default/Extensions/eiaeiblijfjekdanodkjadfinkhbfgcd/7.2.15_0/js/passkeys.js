(()=>{"use strict";const e=Object.prototype.toString;function t(t,{urlSafe:n=!1}={}){!function(t){if(!function(t){return function(t,n){return!!t&&(t.constructor===n||"[object Uint8Array]"===e.call(t))}(t,Uint8Array)}(t))throw new TypeError(`Expected \`Uint8Array\`, got \`${typeof t}\``)}(t);let a="";for(let e=0;e<t.length;e+=65535){const n=t.subarray(e,e+65535);a+=globalThis.btoa(String.fromCodePoint.apply(void 0,n))}return n?function(e){return e.replaceAll("+","-").replaceAll("/","_").replace(/=+$/,"")}(a):a}function n(e){return function(e){if("string"!=typeof e)throw new TypeError(`Expected \`string\`, got \`${typeof e}\``)}(e),Uint8Array.from(globalThis.atob(function(e){const t=e.replaceAll("-","+").replaceAll("_","/"),n=(4-t.length%4)%4;return t+"=".repeat(n)}(e)),e=>e.codePointAt(0))}new globalThis.TextDecoder("utf8"),new globalThis.TextEncoder,Array.from({length:256},(e,t)=>t.toString(16).padStart(2,"0"));const a=["complete","interactive"];if(window.requestIdleCallback||(window.requestIdleCallback=function(e,t){var n=(t=t||{}).timeout||1,a=performance.now();return setTimeout(function(){e({get didTimeout(){return!t.timeout&&performance.now()-a-1>n},timeRemaining:function(){return Math.max(0,performance.now()-a+1)}})},1)}),window.cancelIdleCallback||(window.cancelIdleCallback=function(e){clearTimeout(e)}),window.requestAnimationFrame||(window.requestAnimationFrame=function(e){return window.setTimeout(function(){e(Date.now())},1e3/60)}),window.cancelAnimationFrame||(window.cancelAnimationFrame=function(e){clearTimeout(e)}),"credentials"in navigator){PublicKeyCredential.isUserVerifyingPlatformAuthenticatorAvailable=()=>Promise.resolve(!0);const e=n=>{const a={};for(const r in n)if(n[r]instanceof ArrayBuffer)a[r]=t(new Uint8Array(n[r]));else if("object"==typeof n[r])a[r]=e(n[r]);else if("function"==typeof n[r]&&r.startsWith("get")){const t=r.substring(3).charAt(0).toLowerCase()+r.slice(4);t&&(a[t]=e(n[r]()))}else a[r]=n[r];return a};CredentialsContainer.prototype.create=new Proxy(CredentialsContainer.prototype.create,{apply(t,r,s){const o=s[0];return new Promise((i,c)=>{if(!(null==o?void 0:o.publicKey))return void t.apply(r,s).then(i).catch(c);const p=a=>{if("NORDPASS/LOGIN_OR_MP_SCREEN_CLOSED"!==a.data.type){if("NORDPASS/CREDENTIAL_CREATE_SUCCESS"===a.data.type&&a.data.origin===window.origin)switch(window.removeEventListener("message",p),a.data.choice){case"use_browser_method":t.apply(r,s).then(i).catch(c);break;case"use_nordpass":{a.data.response.id=a.data.response.credentials_id,a.data.response.type=a.data.response.credentials_type,a.data.response.rawId=n(a.data.response.rawId).buffer,a.data.response.response.attestationObject=n(a.data.response.response.attestationObject).buffer,a.data.response.response.clientDataJSON=n(a.data.response.response.clientDataJSON).buffer,a.data.response.getClientExtensionResults=()=>new ArrayBuffer(0),a.data.response.response.getTransports=()=>["internal","hybrid"];const{publicKeyAlgorithm:t,publicKey:r,authenticatorData:s}=a.data.response.response;a.data.response.response.getPublicKeyAlgorithm=()=>t,a.data.response.response.getPublicKey=()=>n(r).buffer,a.data.response.response.getAuthenticatorData=()=>n(s).buffer,a.data.response.toJSON=()=>e(a.data.response),delete a.data.response.response.publicKeyAlgorithm,delete a.data.response.response.publicKey,delete a.data.response.response.authenticatorData;const c=Object.assign(Object.assign({},a.data.response),{signal:null==o?void 0:o.signal});Object.setPrototypeOf(c.response,AuthenticatorAttestationResponse.prototype),Object.setPrototypeOf(c,PublicKeyCredential.prototype),i(c);break}default:c(Error("Unknown error"))}}else t.apply(r,s).then(i).catch(c)};window.addEventListener("message",p),o.publicKey.user.id=new Uint8Array(o.publicKey.user.id);const d=Object.assign(Object.assign({},o.publicKey),{challenge:new Uint8Array(o.publicKey.challenge)});a.includes(document.readyState)?requestIdleCallback(()=>{window.postMessage(Object.assign({type:"PASSKEY/CREDENTIALS_CREATE"},d),{targetOrigin:window.origin})},{timeout:500}):document.addEventListener("DOMContentLoaded",function e(){document.removeEventListener("DOMContentLoaded",e,!1),requestIdleCallback(()=>{window.postMessage(Object.assign({type:"PASSKEY/CREDENTIALS_CREATE"},d),{targetOrigin:window.origin})},{timeout:500})},!1)})}}),CredentialsContainer.prototype.get=new Proxy(CredentialsContainer.prototype.get,{apply(t,r,s){const o=s[0];return new Promise((i,c)=>{var p;if(!(null==o?void 0:o.publicKey))return void t.apply(r,s).then(i).catch(c);const d=a=>{if("NORDPASS/LOGIN_OR_MP_SCREEN_CLOSED"!==a.data.type){if("NORDPASS/CREDENTIAL_GET_SUCCESS"===a.data.type)switch(window.removeEventListener("message",d),a.data.choice){case"use_browser_method":t.apply(r,s).then(i).catch(c);break;case"use_nordpass":{a.data.response.id=a.data.response.credentials_id,a.data.response.type=a.data.response.credentials_type,a.data.response.rawId=a.data.response.rawId instanceof ArrayBuffer?a.data.response.rawId:n(a.data.response.rawId).buffer,a.data.response.response.authenticatorData=a.data.response.response.authenticatorData instanceof ArrayBuffer?a.data.response.response.authenticatorData:n(a.data.response.response.authenticatorData).buffer,a.data.response.response.clientDataJSON=a.data.response.response.clientDataJSON instanceof ArrayBuffer?a.data.response.response.clientDataJSON:n(a.data.response.response.clientDataJSON).buffer,a.data.response.response.signature=a.data.response.response.signature instanceof ArrayBuffer?a.data.response.response.signature:n(a.data.response.response.signature).buffer,a.data.response.response.userHandle=a.data.response.response.userHandle instanceof ArrayBuffer?a.data.response.response.userHandle:n(a.data.response.response.userHandle).buffer,a.data.response.getClientExtensionResults=()=>new ArrayBuffer(0),a.data.response.response.getTransports=()=>["internal","hybrid"],a.data.response.toJSON=()=>e(a.data.response);const t=Object.assign(Object.assign({},a.data.response),{signal:null==o?void 0:o.signal});Object.setPrototypeOf(t.response,AuthenticatorAssertionResponse.prototype),Object.setPrototypeOf(t,PublicKeyCredential.prototype),i(t);break}default:c(Error("Unknown error"))}}else t.apply(r,s).then(i).catch(c)};if(window.addEventListener("message",d),"conditional"===o.mediation)t.apply(r,s).then(i).catch(c);else{null===(p=o.publicKey.allowCredentials)||void 0===p||p.forEach(e=>{e.id=new Uint8Array(e.id)});const e=Object.assign(Object.assign({},o.publicKey),{challenge:new Uint8Array(o.publicKey.challenge)});a.includes(document.readyState)?requestIdleCallback(()=>{window.postMessage(Object.assign({type:"PASSKEY/CREDENTIALS_GET"},e),{targetOrigin:window.origin})},{timeout:500}):document.addEventListener("DOMContentLoaded",function t(){document.removeEventListener("DOMContentLoaded",t,!1),requestIdleCallback(()=>{window.postMessage(Object.assign({type:"PASSKEY/CREDENTIALS_GET"},e),{targetOrigin:window.origin})},{timeout:500})},!1)}})}})}})();
//# sourceMappingURL=passkeys.js.map