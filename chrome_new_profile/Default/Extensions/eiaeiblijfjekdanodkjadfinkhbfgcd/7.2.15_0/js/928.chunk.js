"use strict";(self.webpackChunknordpass=self.webpackChunknordpass||[]).push([[928],{36928:(e,s,n)=>{n.d(s,{EmergencyAccess:()=>z});var t=n(74848),a=n(96540),c=n(58065),r=n(47767),i=n(92561),l=n(1876),o=n(90895),d=n(35389),u=n(24291),m=n(70025),x=n(9908),g=n(13123),h=n(91120),f=n(18),v=n(90867),p=n(65125),y=n(49374),b=n(32980),E=n(6442),j=n(45847);const A=["Enter",",",";"," "];var C=n(89389),w=n(69883),k=n(81841),N=n(92067),S=n(55910);const _=({className:e,emailChips:s,onChange:n,onBlur:a,onKeyDown:c,inputValue:r,placeholder:i,hasTopBorder:l,scrollableDivRef:o,inputRef:d,onFocus:u,children:m})=>{const{formatMessage:x}=(0,E.A)();return(0,t.jsxs)("div",{className:(0,S.cx)("flex items-center justify-between px-6 border-b border-grey-lighter dark:border-[--dmd-3]",l&&"border-t",e),children:[(0,t.jsx)("div",{className:"text-grey-darker mr-1 mt-4 h-6 self-start whitespace-nowrap leading-6 dark:text-white",children:(0,t.jsx)(h.aZ_,{className:"text-ref-color-grey-50"})}),(0,t.jsx)("div",{ref:o,className:"max-h-30 flex-1 overflow-y-auto",children:(0,t.jsxs)("div",{className:"flex flex-wrap py-3",children:[s,(0,t.jsx)("input",{autoFocus:!0,ref:d,value:r,className:"min-w-45 placeholder:text-grey focus:text-grey-darker dark:placeholder:text-ref-color-grey-50 m-1 h-6 flex-1 resize-none overflow-y-auto overflow-x-hidden bg-inherit text-sm font-medium leading-normal outline-none dark:focus:text-white",id:"emails","data-testid":"email-input",placeholder:null!=i?i:x({id:"enterEmailAddressLabel"}),onChange:e=>n(e.target.value),onKeyDown:c,onFocus:u,onBlur:a})]})}),m]})};var G=n(53353),R=n(3428);const D=({message:e})=>(0,t.jsx)("div",{className:"invalid -mx-6 flex justify-center border-t border-grey-lighter bg-red/20 px-6 py-3 align-middle dark:border-[--dmd-3]",children:(0,t.jsx)("span",{"data-testid":"error-message",className:"text-xs leading-[18px] text-red",children:e})}),T=({title:e,email:s,onRemove:n,isInvalid:a})=>(0,t.jsx)(h.vu3,{type:a?"danger":"primary",classNames:"ml-1 mt-1 max-w-[185px]",icon:"close",dataTestId:`email-chip-${s}-remove-button`,message:e||s,onClick:()=>n(s)});var F=function(e,s,n,t){return new(n||(n=Promise))(function(a,c){function r(e){try{l(t.next(e))}catch(e){c(e)}}function i(e){try{l(t.throw(e))}catch(e){c(e)}}function l(e){var s;e.done?a(e.value):(s=e.value,s instanceof n?s:new n(function(e){e(s)})).then(r,i)}l((t=t.apply(e,s||[])).next())})};const I=({onGiveAccessSuccess:e})=>{const[s,n]=(0,a.useState)(""),[r,i]=(0,a.useState)([]),[l,d]=(0,a.useState)([]),[x,g]=(0,a.useState)(!1),[h,f]=(0,a.useState)(""),{formatMessage:y}=(0,E.A)(),{scrollableElementRef:b}=(e=>{const s=(0,a.useRef)(null),n=(0,R.ZC)(e,0);return(0,a.useEffect)(()=>{n<=e&&s.current&&(s.current.scrollTop=s.current.scrollHeight)},[n,e]),{scrollableElementRef:s}})(r.length),S=(0,u.d4)(w.JQ),I=(0,C.$)(),M=(0,u.wA)();(0,a.useEffect)(()=>{(r.every(e=>!l.includes(e))&&l.length>0||r.length<1)&&f("")},[r,l]);const B=(0,a.useCallback)(e=>e.includes(s)?e:[...e,s],[s]),V=(0,a.useCallback)(e=>{e===S?(d(B),f(y({id:"cannotGiveAccessToYourself"}))):l.includes(e)&&f(y({id:"cannotGiveAccess"}))},[S,l,B,y]),z=(0,a.useCallback)(()=>{(0,N.xf)(s)&&(i(B),n(""),V(s))},[s,B,V]),H=(0,a.useCallback)(e=>{i(s=>s.filter(s=>s!==e))},[]);return(0,t.jsxs)(t.Fragment,{children:[h&&(0,t.jsx)(D,{message:h}),(0,t.jsxs)("form",{noValidate:!0,className:"text-sm font-medium leading-normal text-grey-darker",onSubmit:s=>F(void 0,void 0,void 0,function*(){s.preventDefault(),yield(0,p.c)(()=>F(void 0,void 0,void 0,function*(){try{g(!0),yield v.FH.emergencyAccess.giveEmergencyAccess(r),v.FH.action.save(o.ay.EmergencyAccessSuccess),e(),M((0,m.__)(!0)),yield v.FH.emergencyAccess.fetchGivenEmergencyAccesses().catch(()=>(0,j.$)((0,t.jsx)(c.A,{id:"somethingWentWrongTryAgain"})))}catch(e){const{info:s={}}=e,n=(0,k.u)(e),{non_existing_users:t=[],organization_users:a=[]}=s;d([...t||[],...a||[]]),f(n)}finally{g(!1),M((0,m.__)(!1))}})),I||e()}),children:[(0,t.jsx)(_,{className:"-mx-6",scrollableDivRef:b,emailChips:r.map(e=>(0,t.jsx)(T,{title:e,email:e,isInvalid:l.includes(e),onRemove:H},e)),inputValue:s,hasTopBorder:!h,onKeyDown:e=>{const t="Enter"===e.key&&!s&&r.length>0;if(A.includes(e.key)&&!t)e.preventDefault(),z();else if("Backspace"===e.key&&""===s){e.preventDefault();const s=r.slice(0),t=s.pop();i(s),n(t||"")}},onBlur:z,onChange:n}),(0,t.jsx)("div",{className:"flex justify-end pt-6",children:(0,t.jsx)(G.w,{buttonText:(0,t.jsx)(c.A,{id:"giveAccess"}),isLoading:x,isDisabled:r.length<1||!!h})})]})]})},M=({onClose:e})=>(0,t.jsxs)(b.z,{close:e,shouldCloseOnOverlayClick:!1,className:"w-[600px]",title:(0,t.jsx)(c.A,{id:"giveAccess"}),children:[(0,t.jsx)("div",{className:"pb-6 text-xs leading-[18px] tracking-[-.01em] text-grey-dark dark:text-[--dmd-1]",children:(0,t.jsx)(c.A,{id:"giveAccessDescription",values:{numberOfDays:y.tP}})}),(0,t.jsx)(I,{onGiveAccessSuccess:e})]}),B=({children:e,onGiveAccess:s,isDisabled:n})=>(0,t.jsx)("div",{className:"border-b border-grey-lighter px-12 dark:border-[--dmd-3]",children:(0,t.jsxs)("div",{className:"mx-auto flex min-h-[34px] w-full max-w-[1000px] items-center justify-between",children:[(0,t.jsx)("div",{className:"flex",children:e}),(0,t.jsx)(h.m_M,{title:n?(0,t.jsx)(c.A,{id:"premiumFeature"}):null,placement:"top",children:(0,t.jsx)("span",{children:(0,t.jsx)(h.$nd,{rank:"primary","data-testid":"emergency-access-give-access-button",disabled:n,onClick:s,children:(0,t.jsx)(c.A,{id:"giveEmergencyAccessButton"})})})})]})});var V=n(58997);const z=()=>{const e=(0,u.wA)(),s=(0,r.Zp)(),n=!!(0,r.RQ)(l.bw.EMERGENCY_ACCESS_GIVEN),y=!!(0,r.RQ)(l.bw.EMERGENCY_ACCESS_RECEIVED),[b,E]=(0,a.useState)(!1),[j,A]=(0,a.useState)(y?1:0),C=(0,u.d4)(m._E).some(e=>"pending"===e.status),{isFreeUser:w}=(0,d.d)();return(0,a.useEffect)(()=>{n||y||s(l.bw.EMERGENCY_ACCESS_GIVEN,{replace:!0})},[n,y,s]),(0,a.useEffect)(()=>{s(0===j?l.bw.EMERGENCY_ACCESS_GIVEN:l.bw.EMERGENCY_ACCESS_RECEIVED)},[j,s]),(0,t.jsxs)(V.M,{headerContent:(0,t.jsx)(c.A,{id:"emergencyAccess"}),subHeaderContent:(0,t.jsx)(B,{isDisabled:(0,g.C)(w),onGiveAccess:()=>{(0,p.c)(()=>{v.FH.action.save(o.ay.EmergencyAccessGiveAccessTap),w?e((0,f.LQ)({type:x.q.PremiumUpgrade,metadata:{source:i.E.EmergencyAccess}})):E(!0)})},children:(0,t.jsxs)(h.tUM,{activeKey:j,size:"large",onChange:A,children:[(0,t.jsx)(h.ozo,{tabKey:0,"data-testid":"emergency-access-given-tab",children:(0,t.jsx)(c.A,{id:"emergencyAccessGivenTab"})}),(0,t.jsx)(h.ozo,{tabKey:1,"data-testid":"emergency-access-received-tab",hasIndicator:C,children:(0,t.jsx)(c.A,{id:"emergencyAccessReceivedTab"})})]})}),onGoBack:()=>s(l.bw.SETTINGS),children:[(0,t.jsx)(r.sv,{}),b&&(0,t.jsx)(M,{onClose:()=>E(!1)})]})}}}]);
//# sourceMappingURL=928.chunk.js.map